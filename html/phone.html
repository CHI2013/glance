<!DOCTYPE html>
<html>
  <head> 
    <title>Phone</title>

		<meta charset = "UTF-8">
		<meta name = "viewport" content="width=device-width, initial-scale=1">
		<title> CHI'13 Schedule </title>
		<link rel="stylesheet" href="css/jquery.mobile.structure-1.1.1.css" />
		<link rel="stylesheet" href="css/jquery.mobile-1.1.1.min.css" />
		<link rel="stylesheet" href="css/custom.css"/>
 		<script src="lib/jquery.min.js"></script>
  		<script src="lib/jquery.mobile-1.1.1.min.js"></script>
    	<script src="/socket.io/socket.io.js"></script>
    	<script src="lib/phone.js"></script>
  </head>

  <body>
				<div data-role="page" id="home" data-theme="a">
				<div data-role="header" style="height:10%">
					<a href="index.html" data-role="button" data-icon="arrow-l">Previous</a>
					<h1> CHI'13 </h1>
					<a href="index.html" data-role="button" data-icon="refresh">Now</a>
				</div>
				<div data-role="content">
					<div id="branding">
						<h1> Current Events</h1>
					</div>
					<div class="choice_list">
						<ul data-role="listview" data-insert="true" >
							<!-- <li class="short"><a href="talk.html" data-transition="slide"><img src="img/add.png"/> <h3>Fancy Talk Title</h3><p>Something about humans...</p></a></li>
		 -->
							<li class="short light_blue">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile1">Select a tag</h3></a>

								<a class="light_blue" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short orange">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile2"> Select another tag </h3></a>

								<a class="orange" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short purple">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile3">Select another tag</h3></a>

								<a class="purple" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short red">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile4">Select another tag</h3></a>

								<a class="red" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short blue">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile5">Select another tag</h3></a>

								<a class="blue" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short green">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile6">Select another tag </h3></a>

								<a class="green" href="talk.html" data-transition="slide"></a>
							</li>

							<li class="footer" data-icon="info" data-iconpos="bottom">
								<a href="tags2.html" data-transition="slideup">  <h3 id="footer">Tags </h3></a>
							</li>
		<!-- 					<li  class="short" id="listitem"> Swipe me right! </li>
		 -->
						</ul>
					</div>
				</div>
			</div> <!-- END PAGE -->

		<script>
		
		function removeDups( my_array ) {
		    my_array.sort();
		    for ( var i = 1; i < my_array.length; i++ ) {
		        if ( my_array[i] === my_array[ i - 1 ] ) {
		                    my_array.splice( i--, 1 );
		        }
		    }
		    return my_array;
		};
		
		//Code to sync up with the server
		var socket = io.connect("http://"+window.location.hostname, {port: 8000});
		var tiles = document.getElementsByTagName("h3");
		
		socket.on('tick', function(count) {
		    console.log("Tick " + count);
				 return $.get('/tiles', function(data) {
		        console.log("Filters loaded!" + data);
						var arr = [];
						for (var id in data)
						{ 
							var tile = data[id];
							for(property in tile)
							{
								var kind = tile[property];
								for(submissions in kind)
								{
									var submission = kind[submissions];
									for(sessions in submission)
									{
										var session = submission[sessions].title;
										if(session)								
										arr.push(session);

									}
								}
							}
						}				
					  var uniques = removeDups(arr);		

						for (i=0; i< 6; i ++){
							if(arr[i])
							  var x = tiles[i].innerHTML = arr[i];
						  else
						   var x = tiles[i].innerHTML = "Select another tag";

						}
		        return console.log(data);
		      });
    
		});

    socket.on('tilesUpdated', function(data) {
      return $.get('/tiles', function(data) {
        console.log("Filters updated!" + data);
				var arr = [];
				for (var id in data)
				{ 
					var tile = data[id];
					for(property in tile)
					{
						var kind = tile[property];
						for(submissions in kind)
						{
							var submission = kind[submissions];
							for(sessions in submission)
							{
								var session = submission[sessions].title;
								if(session)								
								arr.push(session);
					  		
							}
						}
					}
				}				
			  var uniques = removeDups(arr);		
			  
				for (i=0; i< 6; i ++){
					if(arr[i])
					  var x = tiles[i].innerHTML = arr[i];
				  else
				   var x = tiles[i].innerHTML = "Add another tag";
				
				}
        return console.log(data);
      });
		
				$.get('/ongoingsessions', function(session) {

				    console.log("5: " + session);

				    for( var property in session)
				{
					console.log("4: " + property);

				}

				    var x = document.getElementById("tile2").innerHTML= session[0].Title;

			        console.log("Filters updated!");	
			    });
		
		
		});

		//Code to test  swipe gesture on tile
		$("#listitem").swiperight(function() {
		    $.mobile.changePage("talk.html");
		});

		//Change tile status icon
		$(function(){
			$('img.changer').click(function(){
		 //grab the image just clicked as a jquery object.
		    var img = $(this);

		    console.log(img.data('mode'));

		    if( img.data('mode') === 'alt')
		    {
		    	img
		    	.attr('src', img.data('originalsrc'))
		    	.data('mode','src');
		    }
		    else
		    {
		    	img 
		    	.data('originalsrc', img.attr('src')) //stow the original src
		        .attr('src', img.data('altsrc'))      //update the src
		        .data('mode','alt');                  //tag that the img is in alt mode.
		    }	
		     console.log(img.data('mode'));
			});
		});


		</script>

		</body>
</html>