<!DOCTYPE html>
<html>
  <head> 
    <title>Phone</title>

		<meta charset = "UTF-8">
		<meta name = "viewport" content="width=device-width, initial-scale=1">
		<title> CHI'13 Schedule </title>
		<link rel="stylesheet" href="css/jquery.mobile.structure-1.1.1.css" />
		<link rel="stylesheet" href="css/jquery.mobile-1.1.1.min.css" />
		<link rel="stylesheet" href="css/custom.css"/>
 		<script src="lib/jquery.min.js"></script>
  		<script src="lib/jquery.mobile-1.1.1.min.js"></script>
    	<script src="/socket.io/socket.io.js"></script>
    	<script src="lib/phone.js"></script>
  </head>

  <body>
				<div data-role="page" id="home" data-theme="a">
				<div data-role="header" style="height:10%">
					<a href="index.html" data-role="button" data-icon="arrow-l">Previous</a>
					<h1> CHI'13 </h1>
					<a href="index.html" data-role="button" data-icon="refresh">Now</a>
				</div>
				<div data-role="content">
					<div id="branding">
						<h1> Current Events</h1>
					</div>
					<div class="choice_list">
						<ul data-role="listview" data-insert="true" >
							<!-- <li class="short"><a href="talk.html" data-transition="slide"><img src="img/add.png"/> <h3>Fancy Talk Title</h3><p>Something about humans...</p></a></li>
		 -->
							<li class="short light_blue">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile1">Select a tag</h3></a>

								<a class="light_blue" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short orange">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile2"> Select another tag </h3></a>

								<a class="orange" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short purple">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile3">Select another tag</h3></a>

								<a class="purple" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short red">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile4">Select another tag</h3></a>

								<a class="red" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short blue">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile5">Select another tag</h3></a>

								<a class="blue" href="talk.html" data-transition="slide"> </a>
							</li>

							<li class="short green">
								<a href="#.html" data-transition="slide"> <img class="changer" src="img/add.png" data-altsrc='img/remove.png'/>  <h3 id="tile6">Select another tag </h3></a>

								<a class="green" href="talk.html" data-transition="slide"></a>
							</li>

							<li class="footer" data-icon="info" data-iconpos="bottom">
								<a href="tags2.html" data-transition="slideup">  <h3 id="footer">Tags </h3></a>
							</li>
		<!-- 					<li  class="short" id="listitem"> Swipe me right! </li>
		 -->
						</ul>
					</div>
				</div>
			</div> <!-- END PAGE -->

		<script>
		
		function removeDups( my_array ) {
		    my_array.sort();
		    for ( var i = 1; i < my_array.length; i++ ) {
		        if ( my_array[i] === my_array[ i - 1 ] ) {
		                    my_array.splice( i--, 1 );
		        }
		    }
		    return my_array;
		};

		//  function loadFilters() 
		// {
		// 	$.post("http://localhost:8000/filters",
		// 		{
		// 			"tags": ""
		// 		},
		// 		function(data, status)
		// 		{
		// 			console.log("loaded initial filters: " + data);
		// 		});
		// }
		
		//Code to sync up with the server
		var socket = io.connect("http://"+window.location.hostname, {port: 8000});
		var tiles = document.getElementsByTagName("h3");

		var D = [];
		var E = [];
		var F = [];
		var G = [];
		var H = [];
		var I = [];

	//	var counter = 0;

		var Dc = 0;
		var Ec = 0;
		var Fc = 0;
		var Gc = 0;
		var Hc = 0;
		var Ic = 0;

		socket.on('tick', function(count) {
		    console.log("Tick " + count);
				return $.get('/tiles', function(data) {
		        console.log("Filters loaded!" + data);

				if(D[0])
				{
					if(Dc < D.length)
					{
						var x = tiles[5].innerHTML = D[Dc];
						Dc = Dc + 1;

					}
					else
					{
						Dc = 0;
						var x = tiles[5].innerHTML = D[Dc];
					}
				}
				
				if(E[0])
				{
					if(Ec < E.length)
					{
						var x = tiles[4].innerHTML = E[Ec];
						Ec = Ec + 1;
					}
					else
					{
						Ec = 0;
						var x = tiles[4].innerHTML = E[Ec];
					}
				}

				if(F[0])
				{
					if(Fc < F.length)
					{
						var x = tiles[3].innerHTML = F[Fc];
				    	Fc = Fc + 1;				    	
					}
					else
					{
						Fc = 0;
						var x = tiles[3].innerHTML = F[Fc];
					}
				}

				if(G[0])
				{
					if(Gc < G.length)
					{
						var x = tiles[2].innerHTML = G[Gc];
				    	Gc = Gc + 1;				    	
					}
					else
					{
						Gc = 0;
						var x = tiles[2].innerHTML = G[Gc];
					}
				}
		
				if(H[0])
				{
					if(Hc < H.length)
					{
						var x = tiles[1].innerHTML = H[Hc];
				    	Hc = Hc + 1;				    	
					}
					else
					{
						Hc = 0;
						var x = tiles[1].innerHTML = H[Hc];
					}
				}
				
				if(I[0])
				{
					if(Ic < I.length)
					{
						var x = tiles[0].innerHTML = I[Ic];
				    	Ic = Ic + 1;				    	
				    }
					else
					{
						Ic = 0;
						var x = tiles[0].innerHTML = I[Ic];
					}
				}

				// if(E[counter])
				//   var x = tiles[1].innerHTML = E[counter];
				// if(F[counter])
				//   var x = tiles[2].innerHTML = F[counter];	
				// if(G[counter])
				//   var x = tiles[3].innerHTML = G[counter];
				// if(H[counter])
				//   var x = tiles[4].innerHTML = H[counter];
				// if(I[counter])
				//   var x = tiles[5].innerHTML = I[counter];

				// counter = counter + 1;
				// if(counter == 2) counter = 0;
		      });
		});

    socket.on('tilesUpdated', function(data) {
      return $.get('/tiles', function(data) {
        console.log("Filters updated!" + data);

			for (var id in data)
			{ 
				var tile = data[id];
				if(tile.type == "filter" && tile.hasOwnProperty("filter"))
					if(tile.filter.hasOwnProperty("submissions"))
						for(i = 0; i<tile.filter.submissions.length; i++)
						{									
							//console.log("Tile ID: " + id + " submissions: "  + tile.filter.submissions[i].title);

							if(id == "D"){
								D.push(tile.filter.submissions[i].title);
								console.log("entered D");
							}
							if(id == "E"){
								E.push(tile.filter.submissions[i].title);
								console.log("entered E");

							}
							if(id == "F"){
								F.push(tile.filter.submissions[i].title);
								console.log("entered F");

							}
							if(id == "G"){
								G.push(tile.filter.submissions[i].title);
								console.log("entered G");

							}
							if(id == "H"){
								H.push(tile.filter.submissions[i].title);
								console.log("entered H");

							}
							if(id == "I"){
								I.push(tile.filter.submissions[i].title);
								console.log("entered I " + tile.filter.submissions[i].title);
							}
						}
			}
		    return console.log(data);
		});
	});



		//Code to test  swipe gesture on tile
		$("#listitem").swiperight(function() {
		    $.mobile.changePage("talk.html");
		});

		//Change tile status icon
		$(function(){
			$('img.changer').click(function(){
		 //grab the image just clicked as a jquery object.
		    var img = $(this);

		    console.log(img.data('mode'));

		    if( img.data('mode') === 'alt')
		    {
		    	img
		    	.attr('src', img.data('originalsrc'))
		    	.data('mode','src');
		    }
		    else
		    {
		    	img 
		    	.data('originalsrc', img.attr('src')) //stow the original src
		        .attr('src', img.data('altsrc'))      //update the src
		        .data('mode','alt');                  //tag that the img is in alt mode.
		    }	
		     console.log(img.data('mode'));
			});
		});


		</script>

		</body>
</html>